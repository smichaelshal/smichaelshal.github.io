+++
collection = false
order = 12
authors = [
"Michael Shalitin",

]
math = true
date = "2025-01-24"
tags = [

]
categories = [

]
series = [

]
title = "bl_hlist"
+++


## שימוש של bl_hlist עם hash-table
הוא גרסה מיוחדת של רשימה, שבה ל-head של הרשימה יש נעילה בביט במיקום אפס. זה שימושי עבור טבלאות Hash הניתנות להרחבה מבלי להגדיל את טביעת הרגל של הזיכרון.

ה-`bl_hlist` הוא `hlist` (כלומר `hash-list`) עם נעילת `bit_spinlock`, (bl - קיצור של bit-lock).

רשימת ה-Hash של bit lock הנה גרסת מימוש רשימת hash בקרנל.

אין צורך להקצות מנעול לכל רשימת hash, ורק צריך להשתמש ב-bit של מצביע הראש של הרשימה המקושרת כדי לבצע בקרת גישה במקביל כדי לחסוך תקורה בזיכרון. לדוגמה ב-dcach יש שימוש מרכזי בטבלה כזאת. 


## מימוש הנעילה על bl_hlist

עבור פעולות שינוי, יש להגדיר את הביט ה-0 של המצביע `hlist_bl_head->first` .

עם כמה שינויים קטנים, ניתן להתאים את זה בקלות לאחסון כמה ביטים שרירותיים (לא רק סיביות נעילה בודדות), אם מתעורר צורך לאחסן כמה נתוני עזר מהירים וקומפקטיים.

הרבה מאוד דברים משותפים ל-hlist_bl ול-hlist רגיל, ולכן לא אסביר כאן את הכל, אלה רק את החלקים השונים.

המצב הנעול של הרשימה הוא כשביט הנעילה של ראש הרשימה דלוק.

- הפונקציה `hlist_bl_first` מקבלת מצביע להתחלה של הרשימה (`hlist_bl_head`) ותמיד מחזירה אותו כשביט הנעילה כבוי.

- הפונקציה `hlist_bl_set_first` מעדכנת את שדה ה-`first` של ראש הרשימה (`hlist_bl_head`) ומכניסה את המצביע של `first` עם ביט הנעילה דלוק.
